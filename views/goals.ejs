<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Budget Goals - HoH Bank</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      width: 100vw;
      box-sizing: border-box;
      font-family: 'Inter', 'Georgia', serif;
      background: linear-gradient(120deg, #232946 0%, #0f172a 100%);
      color: #f3f6fa;
      overflow-x: hidden;
    }
       .navbar {
      position: fixed;
      top: 0;
      width: 100vw;
      background: linear-gradient(135deg, #232946 0%, #1e2a3a 100%);
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      z-index: 10;
      padding: 1rem 0;
      border-bottom: 1px solid rgba(125, 249, 255, 0.2);
    }

    .navbar-brand {
      font-weight: 800;
      font-size: 1.6rem;
      color: #7df9ff !important;
      text-shadow: 0 0 15px rgba(125, 249, 255, 0.6);
      letter-spacing: 1.2px;
      font-family: 'Orbitron', sans-serif;
    }

    .navbar-nav .nav-link {
      color: #cbd5e1 !important;
      font-weight: 500;
      transition: all 0.3s ease;
      padding: 0.5rem 1rem !important;
      border-radius: 8px;
      margin: 0 0.25rem;
    }

    .navbar-nav .nav-link:hover {
      color: #7df9ff !important;
      background: rgba(125, 249, 255, 0.1);
      transform: translateY(-2px);
    }

    .navbar-nav .nav-link.active {
      color: #22c55e !important;
      background: rgba(34, 197, 94, 0.1);
    }

    .navbar-toggler {
      border-color: rgba(125, 249, 255, 0.3);
    }

    .navbar-toggler-icon {
      filter: brightness(0) invert(1) drop-shadow(0 0 2px #7df9ff);
    }    .container {
      max-width: 1000px;
      margin: 80px auto 0 auto;
      padding: 40px;
      background: linear-gradient(135deg, #232946 0%, #1e2a3a 100%);
      border-radius: 24px;
      box-shadow: 
        0 25px 60px rgba(34, 197, 94, 0.15),
        0 10px 30px rgba(125, 249, 255, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(125, 249, 255, 0.2);
      position: relative;
      overflow: hidden;
      animation: fadeInUp 0.6s ease-out;
    }

    .goals-header { background: #181f2f; border-radius: 18px; box-shadow: 0 8px 32px #7df9ff22; padding: 2rem 1.5rem; margin: 2rem 0; text-align: center; }
    .goals-header h1 { font-family: 'Orbitron', 'Inter', 'Georgia', serif; color: #7df9ff; font-size: 2.2rem; }
    .table { background: #232946; color: #f3f6fa; border-radius: 10px; overflow: hidden; }
    .table th, .table td { vertical-align: middle; padding: 0.75rem 1.1rem; font-size: 1.01rem; }
    .table th { color: #7df9ff; background: #181f2f; border-bottom: 2px solid #22c55e33; }
    .table-striped > tbody > tr:nth-of-type(odd) { background-color: #232946 !important; }
    .table-striped > tbody > tr:nth-of-type(even) { background-color: #1a2033 !important; }
    .table-hover tbody tr:hover { background-color: #22c55e22 !important; color: #fff; }
    .progress { height: 1.2rem; background: #232946; border-radius: 8px; }
    .progress-bar { font-weight: 600; font-size: 0.98rem; }
    .goal-actions { display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; }
    .goal-actions .btn { min-width: 120px; margin: 6px 0; font-size: 1rem; border-radius: 6px; }
    .goals-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 32px; }
    @media (max-width: 900px) { .goals-grid { grid-template-columns: 1fr; } }
    @media (max-width: 600px) { .goals-header { padding: 1rem 0.3rem; } .table-responsive { font-size: 0.95rem; } .goals-grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <!-- Navbar -->
<nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
      <a class="navbar-brand" href="/dashboard">HoH Bank</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto align-items-center">
          <li class="nav-item"><a class="nav-link" href="/my-products">My Products</a></li>
          <li class="nav-item"><a class="nav-link" href="/goals">Goals</a></li>          
          <li class="nav-item"><a class="nav-link" href="/customer/consultations">Consultations</a></li>
          <li class="nav-item"><a class="nav-link" href="/user-transactions">Transactions</a></li>
            <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="financialLearningDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Financial Learning Tool
            </a>
            <ul class="dropdown-menu" aria-labelledby="financialLearningDropdown">
              <li><a class="dropdown-item" href="/financial-education">ðŸ“˜ Student Financial Education</a></li>
              <li><a class="dropdown-item" href="/financial-resources">ðŸ“š Financial Resources</a></li>
              <li><a class="dropdown-item" href="/financial-quiz">ðŸ§  Financial Quiz</a></li>
            </ul>
          </li>
          <li class="nav-item"><a class="nav-link" href="/profile-edit">Profile</a></li>
          <li class="nav-item"><a class="nav-link" href="/logout/customer">Logout</a></li>
          <li class="nav-item dropdown" id="notificationDropdown" style="position:relative;">
            <a class="nav-link position-relative" href="#" id="navbarDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-bell" style="font-size:1.5rem;"></i>
              <span id="notif-badge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="font-size:0.7rem;display:none;">0</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownMenuLink" style="min-width:320px;max-width:400px;max-height:350px;overflow-y:auto;">
              <li class="dropdown-header">Notifications</li>
              <div id="notif-list">
                <li class="dropdown-item text-muted">Loading...</li>
              </div>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  <script>
    // Fetch notifications and update bell
    function fetchNotifications() {
      fetch('/notifications')
        .then(res => res.json())
        .then(data => {
          const notifList = document.getElementById('notif-list');
          const badge = document.getElementById('notif-badge');
          notifList.innerHTML = '';
          let unread = 0;
          if (data.notifications && data.notifications.length > 0) {
            data.notifications.forEach(note => {
              const li = document.createElement('li');
              li.className = 'dropdown-item' + (note.is_read ? '' : ' fw-bold');
              li.innerHTML = `<span>${note.message}</span><br><small class='text-secondary'>${new Date(note.created_at).toLocaleString()}</small>`;
              notifList.appendChild(li);
              if (!note.is_read) unread++;
            });
          } else {
            notifList.innerHTML = '<li class="dropdown-item text-muted">No notifications</li>';
          }
          badge.style.display = unread > 0 ? 'inline-block' : 'none';
          badge.textContent = unread;
        });
    }
    document.addEventListener('DOMContentLoaded', fetchNotifications);
    // Optionally, refresh notifications every 60s
    setInterval(fetchNotifications, 60000);
  </script>
  </nav>
  <div class="container">
    <div class="goals-header">
      <!-- SVG LOGO START -->
      <div style="display:flex;justify-content:center;align-items:center;gap:1rem;margin-bottom:0.5rem;">
        <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg" style="background:transparent;">
          <circle cx="24" cy="24" r="22" fill="#181f2f" stroke="#7df9ff" stroke-width="3"/>
          <text x="50%" y="56%" text-anchor="middle" fill="#22c55e" font-family="Orbitron, Inter, Arial" font-size="18" font-weight="bold" dy=".3em">HOH</text>
          <polygon points="24,6 27,18 39,18 29,25 32,37 24,30 16,37 19,25 9,18 21,18" fill="#fbbf24" opacity="0.7"/>
        </svg>
        <h1 style="margin:0;">Budget Goals</h1>
      </div>
      <p>Track, edit, and create your savings goals.</p>
      <a href="#addGoalModal" class="btn btn-hoh mt-2" data-bs-toggle="modal" style="background: linear-gradient(90deg, #22c55e 0%, #7df9ff 100%); color: #181f2f; border: none;"><i class="bi bi-plus-circle"></i> Add New Goal</a>
    </div>
    <div class="goals-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:32px;">
      <% if (goals && goals.length > 0) { %>
        <% goals.forEach(function(goal) { 
            const percent = Math.min(100, Math.round(100 * Number(goal.current_savings) / Number(goal.goal_amount)));
            const completed = Number(goal.current_savings) >= Number(goal.goal_amount);
            function daysLeft(targetDate) {
              const today = new Date();
              const target = new Date(targetDate);
              const diff = Math.ceil((target - today) / (1000 * 60 * 60 * 24));
              return diff > 0 ? diff : 0;
            }
        %>
        <div class="goal-card" style="background:#f9fafc;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.06);padding:24px;display:flex;flex-direction:column;align-items:center;min-height:340px;position:relative;color:#232946;">
          <div class="goal-icon" style="width:56px;height:56px;border-radius:50%;background:#e3e7fd;display:flex;align-items:center;justify-content:center;font-size:2rem;margin-bottom:16px;">
            <%= goal.icon || 'ðŸŽ¯' %>
          </div>
          <div class="goal-title" style="font-size:1.3rem;font-weight:600;color:#283593;margin-bottom:8px;text-align:center;">
            <%= goal.goal_name %>
          </div>
          <div class="goal-details" style="font-size:1rem;color:#444;margin-bottom:12px;text-align:center;">
            Category: <%= goal.category %><br>
            Target: $<%= Number(goal.goal_amount).toFixed(2) %><br>
            Saved: $<%= Number(goal.current_savings).toFixed(2) %>
          </div>
          <div class="progress-bar" style="width:100%;height:16px;background:#e0e0e0;border-radius:8px;overflow:hidden;margin-bottom:12px;">
            <div class="progress" style="height:100%;background:linear-gradient(90deg,#1976d2 60%,#64b5f6 100%);border-radius:8px;width:<%= percent %>%;"></div>
          </div>
          <div class="goal-status" style="font-size:0.95rem;color:#388e3c;margin-bottom:8px;font-weight:500;">
            <%= completed ? 'Completed' : percent + '% to goal' %>
          </div>
          <div class="goal-details" style="font-size:1rem;color:#444;margin-bottom:12px;text-align:center;">
            Target Date: <%= goal.target_date ? goal.target_date.toISOString ? goal.target_date.toISOString().slice(0,10) : goal.target_date.toString().slice(0,10) : '-' %> (<%= goal.daysLeft %> days left)
          </div>
          <% if (goal.dailySuggestion && goal.weeklySuggestion) { %>
          <div class="goal-details" style="font-size:0.98rem;color:#1976d2;margin-bottom:10px;text-align:center;">
            <i class="bi bi-lightbulb"></i> Save $<%= goal.dailySuggestion %> per day or $<%= goal.weeklySuggestion %> per week to reach your goal on time.
          </div>
          <% } %>
          <% if (completed) { %>
            <div class="goal-completed" style="color:#fff;background:#388e3c;border-radius:6px;padding:4px 12px;font-size:0.95rem;position:absolute;top:18px;right:18px;">Completed</div>
          <% } %>
          <div class="goal-actions" style="display:flex;gap:12px;margin-top:auto;flex-wrap:wrap;">
            <button type="button" class="btn btn-hoh btn-sm" style="background:linear-gradient(90deg,#fbbf24 0%,#22c55e 100%);color:#181f2f;border:none;border-radius:6px;padding:8px 18px;font-size:1rem;cursor:pointer;" data-bs-toggle="modal" data-bs-target="#addSavingsModal" data-goalid="<%= goal.goal_id %>">Add Savings</button>
            <button type="button" class="btn btn-hoh btn-sm" style="background:linear-gradient(90deg,#22c55e 0%,#7df9ff 100%);color:#181f2f;border:none;border-radius:6px;padding:8px 18px;font-size:1rem;cursor:pointer;" data-bs-toggle="modal" data-bs-target="#recurringTransferModal" data-goalid="<%= goal.goal_id %>">Set Up Recurring Transfer</button>
            <button type="button" class="btn btn-hoh btn-sm" style="background:linear-gradient(90deg,#f87171 0%,#fbbf24 100%);color:#181f2f;border:none;border-radius:6px;padding:8px 18px;font-size:1rem;cursor:pointer;" data-bs-toggle="modal" data-bs-target="#withdrawModal" data-goalid="<%= goal.goal_id %>" data-max="<%= goal.current_savings %>">Withdraw</button>
            <button type="button" class="btn btn-hoh btn-sm" style="background:linear-gradient(90deg,#fbbf24 0%,#22c55e 100%);color:#181f2f;border:none;border-radius:6px;padding:8px 18px;font-size:1rem;cursor:pointer;" data-bs-toggle="modal" data-bs-target="#editGoalModal" data-goal='<%- JSON.stringify(goal) %>'>Edit</button>
  <!-- Edit Goal Modal -->
  <div class="modal fade" id="editGoalModal" tabindex="-1" aria-labelledby="editGoalModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content bg-dark text-light">
        <div style="background: linear-gradient(120deg, #232946 0%, #181f2f 100%); border-radius: 8px;">
        <form id="editGoalForm" method="POST">
          <div class="modal-header">
            <h5 class="modal-title" id="editGoalModalLabel">Edit Budget Goal</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="edit_goal_name" class="form-label">Goal Name</label>
              <input type="text" class="form-control" id="edit_goal_name" name="goal_name" required>
            </div>
            <div class="mb-3">
              <label for="edit_category" class="form-label">Category</label>
              <select class="form-control" id="edit_category" name="category" required>
                <option value="">Select Category</option>
                <option value="Travel">Travel</option>
                <option value="Education">Education</option>
                <option value="Shopping">Shopping</option>
                <option value="Emergency Fund">Emergency Fund</option>
                <option value="Home Improvement">Home Improvement</option>
                <option value="Health & Fitness">Health & Fitness</option>
                <option value="Family & Kids">Family & Kids</option>
                <option value="Retirement">Retirement</option>
                <option value="Entertainment">Entertainment</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="edit_goal_amount" class="form-label">Target Amount</label>
              <input type="number" class="form-control" id="edit_goal_amount" name="goal_amount" min="1" step="0.01" required>
            </div>
            <div class="mb-3">
              <label for="edit_target_date" class="form-label">Target Date</label>
              <input type="date" class="form-control" id="edit_target_date" name="target_date" required>
            </div>
          </div>
          <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 10px;">
            <button type="button" class="btn" style="background: #fbbf24; color: #181f2f; border-radius: 6px; min-width: 100px;" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn" style="background: #22c55e; color: #fff; border-radius: 6px; min-width: 100px;">Save</button>
          </div>
        </form>
        </div>
      </div>
    </div>
  </div>
  <script>
    // Pre-fill Edit Goal Modal
    var editGoalModal = document.getElementById('editGoalModal');
    editGoalModal.addEventListener('show.bs.modal', function (event) {
      var button = event.relatedTarget;
      var goal = JSON.parse(button.getAttribute('data-goal'));
      var form = document.getElementById('editGoalForm');
      form.action = '/goals/edit/' + goal.goal_id;
      document.getElementById('edit_goal_name').value = goal.goal_name;
      document.getElementById('edit_category').value = goal.category;
      document.getElementById('edit_goal_amount').value = goal.goal_amount;
      document.getElementById('edit_target_date').value = goal.target_date ? goal.target_date.toString().slice(0,10) : '';
    });
  </script>
  <!-- Withdraw Modal -->
  <div class="modal fade" id="withdrawModal" tabindex="-1" aria-labelledby="withdrawModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content bg-dark text-light">
        <div style="background: linear-gradient(120deg, #232946 0%, #181f2f 100%); border-radius: 8px;">
        <form id="withdrawForm" method="POST">
          <div class="modal-header">
            <h5 class="modal-title" id="withdrawModalLabel">Withdraw from Goal</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="withdraw_amount" class="form-label">Amount to Withdraw</label>
              <input type="number" class="form-control" id="withdraw_amount" name="withdraw_amount" min="1" step="0.01" required>
              <small id="withdrawMax" class="text-secondary"></small>
            </div>
            <div class="mb-3">
              <label for="withdraw_account_id" class="form-label">Return to Account</label>
              <select class="form-control" id="withdraw_account_id" name="account_id" required>
                <% if (accounts && accounts.length > 0) { %>
                  <% accounts.forEach(function(account) { %>
                    <option value="<%= account.account_id %>"><%= account.account_type %> - <%= account.account_number %> ($<%= Number(account.balance).toFixed(2) %>)</option>
                  <% }); %>
                <% } else { %>
                  <option value="">No accounts found</option>
                <% } %>
              </select>
            </div>
          </div>
          <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 10px;">
            <button type="button" class="btn" style="background: #fbbf24; color: #181f2f; border-radius: 6px; min-width: 100px;" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn" style="background: #22c55e; color: #fff; border-radius: 6px; min-width: 100px;">Withdraw</button>
          </div>
        </form>
        </div>
      </div>
    </div>
  </div>
  <script>
    var withdrawModal = document.getElementById('withdrawModal');
    withdrawModal.addEventListener('show.bs.modal', function (event) {
      var button = event.relatedTarget;
      var goalId = button.getAttribute('data-goalid');
      var max = button.getAttribute('data-max');
      var form = document.getElementById('withdrawForm');
      form.action = '/goals/withdraw/' + goalId;
      document.getElementById('withdraw_amount').max = max;
      document.getElementById('withdrawMax').textContent = 'Max withdrawable: $' + Number(max).toFixed(2);
    });
  </script>
            <form action="/goals/delete/<%= goal.goal_id %>" method="POST" style="display:inline;">
              <button type="submit" class="btn btn-hoh btn-sm" style="background:linear-gradient(90deg,#f87171 0%,#fbbf24 100%);color:#181f2f;border:none;border-radius:6px;padding:8px 18px;font-size:1rem;cursor:pointer;" onclick="return confirm('Delete this goal?');">Delete</button>
            </form>
            <button type="button" class="btn btn-hoh btn-sm" style="background:linear-gradient(90deg,#64b5f6 0%,#1976d2 100%);color:#fff;border:none;border-radius:6px;padding:8px 18px;font-size:1rem;cursor:pointer;" data-bs-toggle="modal" data-bs-target="#detailsModal" data-goalid="<%= goal.goal_id %>">View Details</button>
  <!-- View Details Modal -->
  <div class="modal fade" id="detailsModal" tabindex="-1" aria-labelledby="detailsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content bg-dark text-light">
        <div style="background: linear-gradient(120deg, #232946 0%, #181f2f 100%); border-radius: 8px;">
        <div class="modal-header">
          <h5 class="modal-title" id="detailsModalLabel">Goal Details</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="detailsBody">
          <div class="text-center text-secondary">Loading...</div>
        </div>
        <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 10px;">
          <button type="button" class="btn" style="background: #fbbf24; color: #181f2f; border-radius: 6px; min-width: 100px;" data-bs-dismiss="modal">Close</button>
        </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    // Fetch and show goal details in modal
    var detailsModal = document.getElementById('detailsModal');
    detailsModal.addEventListener('show.bs.modal', function (event) {
      var button = event.relatedTarget;
      var goalId = button.getAttribute('data-goalid');
      var body = document.getElementById('detailsBody');
      body.innerHTML = '<div class="text-center text-secondary">Loading...</div>';
      fetch('/goals/details/' + goalId)
        .then(res => res.json())
        .then(data => {
          if (!data.goal) {
            body.innerHTML = '<div class="text-danger">Goal not found.</div>';
            return;
          }
          let html = `<h5>${data.goal.goal_name}</h5>`;
          html += `<p>Category: <b>${data.goal.category}</b><br>Target: $${Number(data.goal.goal_amount).toFixed(2)}<br>Saved: $${Number(data.goal.current_savings).toFixed(2)}<br>Target Date: ${data.goal.target_date ? data.goal.target_date.toString().slice(0,10) : '-'}</p>`;
          html += `<hr><h6>Savings & Withdrawal History</h6>`;
          if (data.history && data.history.length > 0) {
            html += '<ul class="list-group">';
            data.history.forEach(tx => {
              html += `<li class="list-group-item bg-dark text-light">${tx.transaction_date ? new Date(tx.transaction_date).toLocaleString() : ''} - <b>${tx.transaction_type === 'deposit' ? 'Withdrawal' : 'Savings'}</b>: $${Number(tx.amount).toFixed(2)} <span class='text-secondary small'>${tx.description || ''}</span></li>`;
            });
            html += '</ul>';
          } else {
            html += '<div class="text-muted">No savings or withdrawal history.</div>';
          }
          body.innerHTML = html;
        })
        .catch(() => { body.innerHTML = '<div class="text-danger">Failed to load details.</div>'; });
    });
  </script>
          </div>
  <!-- Recurring Transfer Modal -->
  <div class="modal fade" id="recurringTransferModal" tabindex="-1" aria-labelledby="recurringTransferModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content bg-dark text-light">
        <div style="background: linear-gradient(120deg, #232946 0%, #181f2f 100%); border-radius: 8px;">
        <form id="recurringTransferForm" method="POST">
          <div class="modal-header">
            <h5 class="modal-title" id="recurringTransferModalLabel">Set Up Recurring Transfer</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="rt_amount" class="form-label">Amount per Transfer</label>
              <input type="number" class="form-control" id="rt_amount" name="amount" min="1" step="0.01" required>
            </div>
            <div class="mb-3">
              <label for="rt_account_id" class="form-label">Select Account</label>
              <select class="form-control" id="rt_account_id" name="account_id" required>
                <% if (accounts && accounts.length > 0) { %>
                  <% accounts.forEach(function(account) { %>
                    <option value="<%= account.account_id %>"><%= account.account_type %> - <%= account.account_number %> ($<%= Number(account.balance).toFixed(2) %>)</option>
                  <% }); %>
                <% } else { %>
                  <option value="">No accounts found</option>
                <% } %>
              </select>
            </div>
            <div class="mb-3">
              <label for="rt_frequency" class="form-label">Frequency</label>
              <select class="form-control" id="rt_frequency" name="frequency" required>
                <option value="">Select Frequency</option>
                <option value="daily">Daily</option>
                <option value="weekly">Weekly</option>
                <option value="monthly">Monthly</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="rt_start_date" class="form-label">Start Date</label>
              <input type="date" class="form-control" id="rt_start_date" name="start_date" required>
            </div>
          </div>
          <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 10px;">
            <button type="button" class="btn" style="background: #fbbf24; color: #181f2f; border-radius: 6px; min-width: 100px;" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn" style="background: #22c55e; color: #fff; border-radius: 6px; min-width: 100px;">Set Up</button>
          </div>
        </form>
        </div>
      </div>
    </div>
  </div>
  <script>
    var recurringTransferModal = document.getElementById('recurringTransferModal');
    recurringTransferModal.addEventListener('show.bs.modal', function (event) {
      var button = event.relatedTarget;
      var goalId = button.getAttribute('data-goalid');
      var form = document.getElementById('recurringTransferForm');
      form.action = '/goals/recurring-transfer/' + goalId;
      // Set min date for recurring transfer start date to today
      var rtStartDate = document.getElementById('rt_start_date');
      if (rtStartDate) {
        var today = new Date().toISOString().split('T')[0];
        rtStartDate.setAttribute('min', today);
      }
    });
  </script>
        </div>
        <% }); %>
      <% } else { %>
        <div style="text-align:center;padding:2.5rem 0;">
          <svg width="80" height="80" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="40" cy="40" r="36" fill="#232946" stroke="#7df9ff" stroke-width="3"/>
            <text x="50%" y="54%" text-anchor="middle" fill="#22c55e" font-family="Orbitron, Inter, Arial" font-size="22" font-weight="bold" dy=".3em">HOH</text>
            <polygon points="40,14 44,32 62,32 46,43 50,61 40,52 30,61 34,43 18,32 36,32" fill="#fbbf24" opacity="0.7"/>
          </svg>
          <h4 style="color:#7df9ff;margin-top:1.2rem;">No budget goals found</h4>
          <p style="color:#b6c2e2;">Start by adding a new goal to track your savings journey!</p>
          <a href="#addGoalModal" class="btn btn-hoh mt-3" data-bs-toggle="modal" style="background: linear-gradient(90deg, #22c55e 0%, #7df9ff 100%); color: #181f2f; border: none;"><i class="bi bi-plus-circle"></i> Add New Goal</a>
        </div>
      <% } %>
    </div>
    <a href="/dashboard" class="btn btn-hoh mt-4"><i class="bi bi-arrow-left"></i> Back to Dashboard</a>
  </div>

  <!-- Add Goal Modal -->
  <div class="modal fade" id="addGoalModal" tabindex="-1" aria-labelledby="addGoalModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content bg-dark text-light">
        <div style="background: linear-gradient(120deg, #232946 0%, #181f2f 100%); border-radius: 8px;">
        <form action="/goals/add" method="POST">
          <div class="modal-header">
            <h5 class="modal-title" id="addGoalModalLabel">Add New Budget Goal</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="goal_name" class="form-label">Goal Name</label>
              <input type="text" class="form-control" id="goal_name" name="goal_name" required>
            </div>
            <div class="mb-3">
              <label for="category" class="form-label">Category</label>
              <select class="form-control" id="category" name="category" required>
                <option value="">Select Category</option>
                <option value="Travel">Travel</option>
                <option value="Education">Education</option>
                <option value="Shopping">Shopping</option>
                <option value="Emergency Fund">Emergency Fund</option>
                <option value="Home Improvement">Home Improvement</option>
                <option value="Health & Fitness">Health & Fitness</option>
                <option value="Family & Kids">Family & Kids</option>
                <option value="Retirement">Retirement</option>
                <option value="Entertainment">Entertainment</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="goal_amount" class="form-label">Target Amount</label>
              <input type="number" class="form-control" id="goal_amount" name="goal_amount" min="1" step="0.01" required>
            </div>
            <div class="mb-3">
              <label for="target_date" class="form-label">Target Date</label>
              <input type="date" class="form-control" id="target_date" name="target_date">
              <span id="dateError" style="color:#f87171;display:none;font-size:0.95rem;margin-top:4px;">Date invalid: Please select a future date.</span>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="background:linear-gradient(90deg,#f87171 0%,#fbbf24 100%);color:#181f2f;border:none;border-radius:6px;padding:8px 18px;font-size:1rem;">Cancel</button>
            <button type="submit" class="btn btn-hoh" style="background:linear-gradient(90deg,#22c55e 0%,#7df9ff 100%);color:#181f2f;border:none;border-radius:6px;padding:8px 18px;font-size:1rem;">Add Goal</button>
        <script>
          // Set min date to today
          document.addEventListener('DOMContentLoaded', function() {
            var today = new Date().toISOString().split('T')[0];
            document.getElementById('target_date').setAttribute('min', today);
          });
          // Validate date on submit
          document.querySelector('#addGoalModal form').addEventListener('submit', function(e) {
            var dateInput = document.getElementById('target_date');
            var dateError = document.getElementById('dateError');
            var selectedDate = new Date(dateInput.value);
            var now = new Date();
            now.setHours(0,0,0,0);
            if (!dateInput.value || selectedDate < now) {
              e.preventDefault();
              dateError.style.display = 'block';
              dateInput.classList.add('is-invalid');
            } else {
              dateError.style.display = 'none';
              dateInput.classList.remove('is-invalid');
            }
          });
        </script>
        </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Add Savings Modal -->
  <div class="modal fade" id="addSavingsModal" tabindex="-1" aria-labelledby="addSavingsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content bg-dark text-light">
        <form id="addSavingsForm" method="POST">
          <div class="modal-header">
            <h5 class="modal-title" id="addSavingsModalLabel">Add Savings to Goal</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="add_amount" class="form-label">Amount to Add</label>
              <input type="number" class="form-control" id="add_amount" name="add_amount" min="1" step="0.01" required>
            </div>
            <div class="mb-3">
              <label for="account_id" class="form-label">Select Account</label>
              <select class="form-control" id="account_id" name="account_id" required>
                <% if (accounts && accounts.length > 0) { %>
                  <% accounts.forEach(function(account) { %>
                    <option value="<%= account.account_id %>"><%= account.account_type %> - <%= account.account_number %> ($<%= Number(account.balance).toFixed(2) %>)</option>
                  <% }); %>
                <% } else { %>
                  <option value="">No accounts found</option>
                <% } %>
              </select>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-hoh">Add Savings</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <script>
    var addSavingsModal = document.getElementById('addSavingsModal');
    addSavingsModal.addEventListener('show.bs.modal', function (event) {
      var button = event.relatedTarget;
      var goalId = button.getAttribute('data-goalid');
      var form = document.getElementById('addSavingsForm');
      form.action = '/goals/add-savings/' + goalId;
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
